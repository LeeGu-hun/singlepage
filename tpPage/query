create table member (
mid number not null,
memail varchar2(50) not null,
mname varchar2(30) not null,
mpw varchar2(30) not null,
mphone varchar2(20),
mcheck number,
mpoint number default 0 not null,
mdate date,
constraint pk_mem primary key(mid)
);

alter table member modify mpoint not null;

create sequence mid_seq increment by 1 start with 1 maxvalue 30000;

insert into member values(mid_seq.nextval, 'email', 'name', 'pw', null, null, 0, sysdate);

insert into member (mid, memail, mname, mpw, mphone, mcheck, mpoint, mdate)
values(mid_seq.nextval, 'email', 'name', 'pw', null, null, 0, sysdate); 


create table page(
pid number not null,
pname varchar2(50) not null,
pnick varchar2(30),
pintro varchar(2000),
pgenre varchar2(50),
ploc varchar2(100),
pperiod date,
pshowtime varchar2(30),
ppoint number default 0 not null,
pdate date,
pmaster number,
constraint pk_page primary key(pid),
constraint fk_page foreign key(pmaster) references member(mid)
);

alter table page add(pfile varchar2(100), pnewfile varchar2(100));
alter table page add(platlng varchar2(100));

alter table page modify ppoint not null;

create sequence pid_seq increment by 1 start with 1 maxvalue 30000;

insert into page values(pid_seq.nextval, 'name', 'nick', 'intoro', null, null, null, null, 0, sysdate, '1', null, null);

insert into page(pid, pname, pnick, pintro, pgenre, ploc, pperiod, pshowtime, ppoint, pdate, pmaster, pfile, pnewfile)
values(pid_seq.nextval, 'name', 'nick', 'intoro', null, null, null, null, 0, sysdate, '1', null, null);


create table pboard(
pbid number not null,
pbsubject varchar2(200) not null,
pbcontent varchar2(3000) not null,
pbfile varchar2(100),
pbnewfile varchar2(100),
pbre_ref int,
pbre_lev int,
pbre_seq int,
pbreadcount int,
pbdate date,
pbhostid int,
pbwriterid int,
constraint pk_pboard primary key(pbid),
constraint fk_pboard_hostid foreign key(pbhostid) references page(pid),
constraint fk_pboard_writerid foreign key(pbwriterid) references member(mid)
);

create sequence pbid_seq increment by 1 start with 1 maxvalue 30000;

insert into pboard values(
pbid_seq.nextval, 'subject', 'content', 'file', 'newfile', 0, 0, 0, 0, sysdate, 1, 1);

insert into pboard (pbid, pbsubject, pbcontent, pbfile, pbnewfile, pbre_ref, pbre_lev, pbre_seq, pbreadcount, pbdate, pbhostid, pbwriterid)
values(pbid_seq.nextval, 'subject', 'content', 'file', 'newfile', 0, 0, 0, 0, sysdate, 1, 1);


create table mboard(
mbid number not null,
mbsubject varchar2(200) not null,
mbcontent varchar2(3000) not null,
mbfile varchar2(100),
mbnewfile varchar2(100),
mbre_ref int,
mbre_lev int,
mbre_seq int,
mbreadcount int,
mbdate date,
mbhostid int,
mbwriterid int,
constraint pk_mboard primary key(mbid),
constraint fk_mboard_hostid foreign key(mbhostid) references page(pid),
constraint fk_mboard_writerid foreign key(mbwriterid) references member(mid)
);

create sequence mbid_seq increment by 1 start with 1 maxvalue 30000;

insert into mboard values(
mbid_seq.nextval, 'subject', 'content', 'file', 'newfile', 0, 0, 0, 0, sysdate, 1, 1);

insert into mboard (mbid, mbsubject, mbcontent, mbfile, mbnewfile, mbre_ref, mbre_lev, mbre_seq, mbreadcount, mbdate, mbhostid, mbwriterid)
values(mbid_seq.nextval, 'subject', 'content', 'file', 'newfile', 0, 0, 0, 0, sysdate, 1, 1);


create table mem_point (
mid number not null,
money number not null,
m_deal_type varchar2(6) not null,
m_deal_date date not null,
pid number,
constraint fk_mp_mid foreign key(mid) references member(mid),
constraint m_type check(m_deal_type in('charge', 'donate')),
constraint fk_mp_pid foreign key(pid) references page(pid));

create table page_point (
pid number not null,
money number not null,
p_deal_type varchar2(7) not null,
p_deal_date date not null,
mid number,
constraint fk_pp_mid foreign key(mid) references member(mid),
constraint p_type check(p_deal_type in('donate', 'realize')),
constraint fk_pp_pid foreign key(pid) references page(pid));

create table page_like (
mid number not null,
plike char(1) not null,
pid number not null,
plike_date date not null,
constraint fk_plike_mid foreign key(mid) references member(mid),
constraint fk_plike_pid foreign key(pid) references page(pid),
constraint plike_status check(plike in('0', '1')));

create table board_like (
mid number not null,
blike char(1) not null,
mbid number,
pbid number,
blike_date date not null,
constraint fk_blike_mid foreign key(mid) references member(mid),
constraint fk_blike_mbid foreign key(mbid) references mboard(mbid),
constraint fk_blike_pbid foreign key(pbid) references pboard(pbid),
constraint blike_status check(blike in('0', '1')));

create table locdb(
sido varchar2(100),
gungu varchar2(100)
);


CREATE TABLE SHOWTIME 
   (PID NUMBER, 
	SHOWSTART NUMBER, 
	SHOWEND NUMBER, 
	 CONSTRAINT FK_SHOWTIME FOREIGN KEY ("PID")
	  REFERENCES PAGE("PID")
   );

   
create or replace trigger showtime after insert or update on page for each row 
declare
shows varchar(10);
showe varchar(10);
words varchar(20);
ss number;
se number;
begin
words := :new.pshowtime;
shows := substr(words, 1, 2);
if shows = '미정' then
ss := 99;
else
ss := to_number(shows);
end if;
showe := substr(words, (instr(words, ' ', 1, 2)+1), 2);
if showe = '미정' then
se := -1;
else
se := to_number(showe);
end if;
if inserting then
insert into showtime values(:new.pid, ss, se);
end if;
if updating then
update showtime set showstart = ss, showend = se where pid = :new.pid;
end if;
end;


update locdb set sido = '경기' where sido = '경기도';
update locdb set sido = '경북' where sido = '경상북도';
update locdb set sido = '경남' where sido = '경상남도';
update locdb set sido = '강원' where sido = '강원도';
update locdb set sido = '충북' where sido = '충청북도';
update locdb set sido = '충남' where sido = '충청남도';
update locdb set sido = '전북' where sido = '전라북도';
update locdb set sido = '전남' where sido = '전라남도';
update locdb set sido = '제주' where sido = '제주도';
commit;